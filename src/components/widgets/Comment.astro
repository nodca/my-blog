---
// Artalk 评论组件
---

<div id="artalk" class="mt-8 pt-8 border-t border-base-300"></div>

<link href="https://unpkg.com/artalk/dist/Artalk.css" rel="stylesheet" />
<script is:inline src="https://unpkg.com/artalk/dist/Artalk.js"></script>

<style is:global>
  /* 邮箱提示样式 */
  .email-hint {
    font-size: 12px;
    color: #888;
    margin-left: 4px;
  }
</style>

<script is:inline>
  function initArtalk() {
    // 清除之前的实例
    var container = document.querySelector('#artalk');
    if (!container) return;
    container.innerHTML = '';

    var artalk = Artalk.init({
      el: '#artalk',
      server: 'https://comment.cyb1.org',
      site: 'nodca的博客',
      pageKey: window.location.pathname,
      darkMode: document.documentElement.getAttribute('data-theme') === 'dracula',
      placeholder: '欢迎留言~',
    });

    // 在邮箱标签旁添加提示
    function addEmailHint() {
      // 查找邮箱标签（而不是输入框）
      var labels = document.querySelectorAll('.atk-header-cell');
      labels.forEach(function(cell) {
        var label = cell.querySelector('.atk-label');
        if (label && (label.textContent.includes('邮箱') || label.textContent.toLowerCase().includes('mail'))) {
          if (!cell.querySelector('.email-hint')) {
            var hint = document.createElement('span');
            hint.className = 'email-hint';
            hint.textContent = '(不会公开)';
            label.insertAdjacentElement('afterend', hint);
          }
        }
      });
    }

    // 多次尝试添加提示（等待 Artalk 渲染完成）
    setTimeout(addEmailHint, 500);
    setTimeout(addEmailHint, 1000);
    setTimeout(addEmailHint, 2000);
  }

  // 初始加载
  document.addEventListener('DOMContentLoaded', initArtalk);

  // Astro 页面切换后重新初始化
  document.addEventListener('astro:page-load', initArtalk);
  document.addEventListener('astro:after-swap', initArtalk);
</script>
